// Инициализация Telegram Web App
const tg = window.Telegram.WebApp;

// Расширяем приложение на весь экран
tg.expand();

// Обработчик события готовности
tg.ready();

// Настраиваем основную кнопку
tg.MainButton.setParams({
    text: 'Задать вопрос',
    color: '#FF7F6A',
});

// Добавляем обработчик клика на кнопку
tg.MainButton.onClick(askAI);

// Данные уроков
const lessons = [
    {
        id: 1,
        title: '0-3 месяца',
        image: 'https://placehold.co/600x400/png?text=0-3+месяца',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики;
- запуск отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;
...`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики;
- запуск отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;
- развитие навыков по возрасту;
- «красные» флажки, что должно насторожить;
- какие игрушки нужны в этом возрасте;
- памятка «Список базовых книг для малыша до 1 года»;
- сценарий самых развивающих игр с малышом;
- как обустроить комнату малыша;
- как помочь в развитии;
- правила безопасности;
- список девайсов, которые облегчат жизнь;
- памятка «График посещения врачей малышами до 1 года»;`,
        author: {
            name: 'Антипенко Наталия',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Детский психолог с компетенцией в области дефектологии и семейной психологии.',
                'Опыт работы с детьми и родителями с 2008г.',
                'Автор проекта "Расту по возрасту".',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/019004e0-762d-711b-ae59-4ec58faca9fc'
    },
    {
        id: 2,
        title: '3-6 месяцев',
        image: 'https://placehold.co/600x400/png?text=3-6+месяцев',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- запуск отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- запуск отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;
- развитие навыков по возрасту;
- «красные» флажки, что должно насторожить;
- какие игрушки нужны в этом возрасте;
- памятка «Список базовых книг для малыша до 1 года»;
- сценарий самых развивающих игр с малышом;
- как обустроить комнату малыша;
- как помочь в развитии;
- правила безопасности;
- список девайсов, которые облегчат жизнь;
- памятка «Выкладывание на живот»;
- памятка «График посещения врачей малышами до 1 года»;`,
        author: {
            name: 'Павшенко Екатерина Анатольевна',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Кандидат педагогических наук.',
                'Психолог, нейропсихолог.',
                'Специалист по раннему интеллектуальному развитию малышей с помощью шахмат.',
                'Автор серии книг «Шахматы с Енотом» ( Изд. «Манн-Иванов-Фербер).',
                'Автор проекта «Расту по возрасту».',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/01900515-4cbc-711b-ae59-549e5bcf6f68'
    },
    {
        id: 3,
        title: '6-9 месяцев',
        image: 'https://placehold.co/600x400/png?text=6-9+месяцев',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- ведущий тип деятельности;
- как развиваются крупная и мелкая моторика;
- как развивается речь;
- развитие навыков по возрасту;
- «красные» флажки, что должно насторожить;
- какие игрушки нужны в этом возрасте;
- памятка «Список базовых книг для малыша до 1 года»;
- сценарий самых развивающих игр с малышом;
- как обустроить комнату малыша;
- как помочь в развитии;
- правила безопасности;
- список девайсов, которые облегчат жизнь;
- памятка «Когда малыш должен сесть»;
- памятка «Ползание малыша»;
- ⁠памятка «Режим сна»;
- памятка «График посещения врачей малышами до 1 года»;`,
        author: {
            name: 'Антипенко Наталия',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Детский психолог с компетенцией в области дефектологии и семейной психологии.',
                'Опыт работы с детьми и родителями с 2008г.',
                'Автор проекта "Расту по возрасту".',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/01900518-cbc8-711b-ae59-5c4e22a7872e'
    },
    {
        id: 4,
        title: '9-12 месяцев',
        image: 'https://placehold.co/600x400/png?text=9-12+месяцев',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- ведущий тип деятельности;
- кризис одного года;
- как развиваются крупная и мелкая моторика;
- как развивается речь;`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- ведущий тип деятельности;
- кризис одного года;
- как развиваются крупная и мелкая моторика;
- как развивается речь;
- развитие навыков по возрасту;
- «красные» флажки, что должно насторожить;
- какие игрушки нужны в этом возрасте;
- памятка «Список базовых книг для малыша до 1 года»;
- сценарий самых развивающих игр с малышом;
- как обустроить комнату малыша;
- как помочь в развитии;
- правила безопасности;
- список девайсов, которые облегчат жизнь;
- памятка «Ползание малыша»;
- памятка «Режим сна»;
- памятка «График посещения врачей малышами до 1 года»;
- памятка «Какие жесты полезно выучить с малышом и как»;
- памятка «Переход с пюре к кусочкам: кустовой этап»;
- памятка «Доступные навыки самостоятельности»;`,
        author: {
            name: 'Павшенко Екатерина Анатольевна',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Кандидат педагогических наук.',
                'Психолог, нейропсихолог.',
                'Специалист по раннему интеллектуальному развитию малышей с помощью шахмат.',
                'Автор серии книг «Шахматы с Енотом» ( Изд. «Манн-Иванов-Фербер).',
                'Автор проекта «Расту по возрасту».',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/01900520-c846-711b-ae59-64bf9f7e3aae'
    },
    {
        id: 5,
        title: '1-2 года',
        image: 'https://placehold.co/600x400/png?text=1-2+года',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- особенности отношений малыша с близкими взрослыми;
- ведущий тип деятельности;
- что нужно делать для развития интеллекта;`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики; 
- развитие отношений привязанности;
- особенности отношений малыша с близкими взрослыми;
- ведущий тип деятельности;
- что нужно делать для развития интеллекта; 
- как развиваются крупная и мелкая моторика;
- как развивается речь;
- развитие навыков по возрасту;
- развитие социально – бытовых навыков;
- режим дня;
- характерные особенности поведения ребенка 1-2 лет;
- «красные» флажки, что должно насторожить;
- какие игрушки нужны в этом возрасте;
- памятка «Как приучить к горшку»;
- памятка «На детской площадке»
- памятка «В какие игры нужно играть малышу для развития»;
- памятка «Как обустроить комнату малыша»;
- памятка «Как помочь в развитии»;
- памятка «Правила безопасности»;
- памятка «Список девайсов, которые облегчат жизнь»;
- памятка «Возрастные страхи»;
- памятка «Дисциплина и границы»;
- памятка «Список базовых игрушек на возраст 1-2 года»;
- памятка «Чем занять малыша в дороге»;
- памятка «Как разговорить малыша»;
- памятка «Что подарить малышу в 1-2 года»;
- памятка «Советы бабушкам и дедушкам 1-2 летних малышей»`,
        author: {
            name: 'Антипенко Наталия',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Детский психолог с компетенцией в области дефектологии и семейной психологии.',
                'Опыт работы с детьми и родителями с 2008г.',
                'Автор проекта "Расту по возрасту".',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/01929973-62c2-7ff2-b317-5041b9893a79'
    },
    {
        id: 6,
        title: '2-3 года',
        image: 'https://placehold.co/600x400/png?text=2-3+года',
        shortDescription: `Содержание видеоурока:
- развитие мозга и психики ребёнка; 
- развитие отношений привязанности;
- особенности отношений малыша с близкими взрослыми и детьми;
- ведущий тип деятельности;
- что нужно делать для развития интеллекта, крупной и мелкой моторики;`,
        fullDescription: `Содержание видеоурока:
- развитие мозга и психики ребёнка; 
- развитие отношений привязанности;
- особенности отношений малыша с близкими взрослыми и детьми;
- ведущий тип деятельности;
- что нужно делать для развития интеллекта, крупной и мелкой моторики; 
- как помочь развитию речи;
- какие бытовые навыки необходимо формировать по возрасту;
- режим дня;
- как научить играть самостоятельно;
- кризис трёх лет.
- характерные особенности поведения ребенка 2-3 лет.

Памятки:
- «Красные» флажки - что должно насторожить;
- «Как приучить к горшку»;
- «Как обустроить комнату малыша»;
- «Как помочь в развитии»;
- «Правила безопасности»;
- «Возрастные страхи»;
- «Как разговорить малыша»;
- «Какие бытовые навыки и навыки самообслуживания формировать»
- «Список книг на возраст 2-3 года»
- «Гаджеты в возрасте 2-3 лет и список самых добрых советских мультфильмов»
- «Как играть с малышом: сценарии игр и идеи для творчества»    
- «Список базовых игрушек на возраст»`,
        author: {
            name: 'Павшенко Екатерина Анатольевна',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Кандидат педагогических наук.',
                'Психолог, нейропсихолог.',
                'Специалист по раннему интеллектуальному развитию малышей с помощью шахмат.',
                'Автор серии книг «Шахматы с Енотом» ( Изд. «Манн-Иванов-Фербер).',
                'Автор проекта «Расту по возрасту».',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/0193f384-df4d-7bbe-bcac-637d21a145b3'
    },
    {
        id: 7,
        title: '3-5 лет',
        image: 'https://placehold.co/600x400/png?text=3-5+лет',
        shortDescription: `Содержание видеоурока:
- Как создать прочную эмоциональную связь с ребенком?
- Почему сюжетно-ролевые игры важнее английского и ментальной арифметики?
- Как избежать ошибок в воспитании и не перегрузить малыша?`,
        fullDescription: `Содержание видеоурока:
- Как создать прочную эмоциональную связь с ребенком?
- Почему сюжетно-ролевые игры важнее английского и ментальной арифметики?
- Как избежать ошибок в воспитании и не перегрузить малыша?
Узнайте, как:
- Развивать мышление, речь и память через игру.
- Поддерживать познавательный интерес без стресса.
- Формировать навыки общения и самостоятельности.
- Характерные особенности поведения ребенка 2-3 лет.
- Что нужно делать для развития интеллекта
- Кризис трёх лет и как пережить истерики`,
        author: {
            name: 'Антипенко Наталия',
            photo: 'placeholder-for-photo.jpg',
            credentials: [
                'Детский психолог с компетенцией в области дефектологии и семейной психологии.',
                'Опыт работы с детьми и родителями с 2008г.',
                'Автор проекта "Расту по возрасту".',
                'Мама троих детей.'
            ]
        },
        price: '3300 ₽',
        link: 'https://rastupovozrastu.ru/videocard/01968141-1342-777a-9848-fc64090fa5af'
    }
];

// Функция для отображения списка уроков с анимацией
function renderLessons() {
    const lessonsList = document.getElementById('lessons-list');
    lessonsList.innerHTML = lessons.map((lesson, index) => `
        <div class="lesson-card" style="animation-delay: ${index * 0.1}s">
            <img class="lesson-image" src="${lesson.image}" alt="${lesson.title}">
            <div class="lesson-content">
                <h2 class="lesson-title">${lesson.title}</h2>
                <p class="lesson-description">${lesson.shortDescription}</p>
                <button class="button" onclick="showLessonDetails(${lesson.id})">Подробнее</button>
            </div>
        </div>
    `).join('');

    // Добавляем обработчик скролла для анимации
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate');
                observer.unobserve(entry.target);
            }
        });
    }, {
        threshold: 0.1
    });

    document.querySelectorAll('.lesson-card').forEach(card => {
        observer.observe(card);
    });
}

// Функция для отображения деталей урока с анимацией
function showLessonDetails(lessonId) {
    const lesson = lessons.find(l => l.id === lessonId);
    const lessonsList = document.getElementById('lessons-list');
    const lessonDetails = document.getElementById('lesson-details');
    const lessonContent = document.getElementById('lesson-full-content');

    lessonsList.style.display = 'none';
    lessonDetails.style.display = 'block';
    
    lessonContent.innerHTML = `
        <h2 class="lesson-title">${lesson.title}</h2>
        <img class="lesson-image" src="${lesson.image}" alt="${lesson.title}">
        <div class="lesson-description">${lesson.fullDescription.replace(/\n/g, '<br>')}</div>
        
        <div class="author-section">
            <div class="author-header">
                <div class="author-photo-placeholder">
                    <img src="${lesson.author.photo}" alt="${lesson.author.name}" class="author-photo">
                </div>
                <h3>Кто ведет: ${lesson.author.name}</h3>
            </div>
            <ul class="author-credentials">
                ${lesson.author.credentials.map(cred => `<li>${cred}</li>`).join('')}
            </ul>
        </div>
        
        <div class="buy-section">
            <span class="price">${lesson.price}</span>
            <button class="button" onclick="window.open('${lesson.link}', '_blank')">Купить урок</button>
        </div>
    `;

    // Сохраняем ID и название текущего урока для ИИ ассистента
    lessonContent.dataset.currentLesson = lessonId;
    lessonContent.dataset.currentLessonTitle = lesson.title;

    // Показываем кнопку "Задать вопрос"
    tg.MainButton.show();

    // Добавляем анимацию появления
    requestAnimationFrame(() => {
        lessonDetails.style.opacity = '0';
        requestAnimationFrame(() => {
            lessonDetails.style.opacity = '1';
        });
    });
}

// Функция для возврата к списку уроков с анимацией
function showLessonsList() {
    const lessonsList = document.getElementById('lessons-list');
    const lessonDetails = document.getElementById('lesson-details');
    
    // Анимация исчезновения
    lessonDetails.style.opacity = '0';
    
    setTimeout(() => {
        lessonDetails.style.display = 'none';
        lessonsList.style.display = 'grid';
        
        // Анимация появления списка
        requestAnimationFrame(() => {
            document.querySelectorAll('.lesson-card').forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(30px)';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    }, 300);

    // Скрываем кнопку при возврате к списку
    tg.MainButton.hide();
}

// Функция для отправки сообщения в чат
function askAI() {
    const lessonContent = document.getElementById('lesson-full-content');
    const lessonId = lessonContent.dataset.currentLesson;
    const lessonTitle = lessonContent.dataset.currentLessonTitle;
    
    // Отправляем сообщение через Telegram Web App
    tg.sendData(JSON.stringify({
        action: 'ask_question',
        lesson_id: lessonId,
        lesson_title: lessonTitle
    }));

    // Закрываем приложение
    tg.close();
}

// Отрисовываем уроки при загрузке страницы
document.addEventListener('DOMContentLoaded', () => {
    renderLessons();
}); 